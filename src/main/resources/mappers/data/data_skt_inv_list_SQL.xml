<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="telecentro.org.data_skt_inv_list">
	<sql id="data_skt_inv_list">
	<![CDATA[
	
		SELECT /*+ index_desc(a SKT_INV_IDX1) */
			TO_CHAR(BILL_DT,'YYYY-MM') BILL_DT,
			BL_ACNT_NUM,
			SERVICE_ACCOUNT,
			SERVICE_NUMBER,
			PROD_CD,
			F_GET_SERVICE_CD_NM(PROD_CD) PROD_CD_NM,
			CUST_NAME,
			CUST_TYPE,
			TAX_USER_FLAG,
			TAX_FLAG,
			F_GET_COMMON_CD_NM('SKT_INV', 'TAX_FLAG', TAX_FLAG) TAX_FLAG_NM,
			TO_CHAR(OPEN_DATE,'YYYY-MM-DD') OPEN_DATE,
			PAY_ITEM_CD,
			F_GET_COMMON_CD_NM('SKT_INV', 'PAY_ITEM_CD', PAY_ITEM_CD) PAY_ITEM_CD_NM,
			INVOICE_ITEM_CD,
			F_GET_COMMON_CD_NM('SKT_INV', 'INVOICE_ITEM_CD', INVOICE_ITEM_CD) INVOICE_ITEM_CD_NM,
			CHARGE_ITEM_CD,
			F_GET_COMMON_CD_NM('SKT_INV', 'CHARGE_ITEM_CD', CHARGE_ITEM_CD) CHARGE_ITEM_CD_NM,
			BILL_ITEM_CD,
			F_GET_COMMON_CD_NM('SKT_INV', 'BILL_ITEM_CD', BILL_ITEM_CD) BILL_ITEM_CD_NM,
			INV_GUBUN,
			BILL_AMOUNT,
			SERVICE_NONPAY_AMOUNT,
			TO_CHAR(MODIFY_DT,'YYYY-MM-DD') MODIFY_DT,
			MODIFY_AMOUNT,
			SKT_AGENT_ID,
			SKT_SALE_ID,
			INV_FLAG,
			AGENT_ID,
			F_GET_AGENT_INFO('AGENT_NAME', AGENT_ID) AGENT_NM,
			RECORD_DATE,
			FILE_NAME
		FROM SKT_INV A
		WHERE BILL_DT > to_date('2023-01-01', 'yyyy-mm-dd')
			AND BILL_DT >= TO_DATE(#{s_dt} || '-01', 'YYYY-MM-DD')
		 	AND BILL_DT < (TO_DATE(#{e_dt} || '-01', 'YYYY-MM-DD') + INTERVAL '1 month') 	
		]]>
		<choose>
			<when test="sword != '' and sword != null">
				<choose>
					<when test="sst == 'service_account'">
					    AND SERVICE_ACCOUNT = #{sword}
					</when>
					<when test="sst == 'service_number'">
						AND (SERVICE_ACCOUNT =  F_GET_ACCOUNT('SKT', #{sword}) OR SERVICE_ACCOUNT =  F_GET_ACCOUNT('SKT', '010' || #{sword}))
					</when>
					<when test="sst == 'bl_acnt_num'">
					    AND BL_ACNT_NUM = #{sword}
					</when>
					<otherwise>
						AND ${@telecentro.common.service.CommonUtil@get_dollar_replace_query(sst)} = #{sword}
					</otherwise>
				</choose>
			</when>
		</choose>	  
			
	</sql>
	<sql id="data_skt_inv_list_add">
	<![CDATA[
	]]>
	</sql>
	<sql id="data_skt_inv_list_add_excel">
	<![CDATA[
	]]>
	</sql>
	<select id="data_skt_inv_list" parameterType="map" resultType="egovMap">
	<![CDATA[
		SELECT
           	fq.BILL_DT,
			fq.BL_ACNT_NUM,
			fq.SERVICE_ACCOUNT,
			fq.SERVICE_NUMBER,
			fq.PROD_CD,
			fq.PROD_CD_NM,
			fq.CUST_NAME,
			fq.CUST_TYPE,
			fq.TAX_USER_FLAG,
			fq.TAX_FLAG,
			fq.TAX_FLAG_NM,
			fq.OPEN_DATE,
			fq.PAY_ITEM_CD,
			fq.PAY_ITEM_CD_NM,
			fq.INVOICE_ITEM_CD,
			fq.INVOICE_ITEM_CD_NM,
			fq.CHARGE_ITEM_CD,
			fq.CHARGE_ITEM_CD_NM,
			fq.BILL_ITEM_CD,
			fq.BILL_ITEM_CD_NM,
			fq.INV_GUBUN,
			fq.BILL_AMOUNT,
			fq.SERVICE_NONPAY_AMOUNT,
			fq.MODIFY_DT,
			fq.MODIFY_AMOUNT,
			fq.SKT_AGENT_ID,
			fq.SKT_SALE_ID,
			fq.INV_FLAG,
			fq.AGENT_ID,
			fq.AGENT_NM,
			fq.RECORD_DATE,
			fq.FILE_NAME
	]]>
		<include refid="data_skt_inv_list_add" />
	<![CDATA[
        FROM (
	]]>
			<include refid="data_skt_inv_list" />
			ORDER BY A.BILL_DT DESC, A.SERVICE_ACCOUNT DESC
			LIMIT #{endRowNum} OFFSET #{startRowNum}
	<![CDATA[
		) fq
	]]>
	</select>

	<select id="data_skt_inv_list_excel" parameterType="map" resultType="egovMap">
		<![CDATA[
			SELECT
	            fq.*
	            ]]><include refid="data_skt_inv_list_add" /><![CDATA[
	            ]]><include refid="data_skt_inv_list_add_excel" /><![CDATA[
	        FROM
	            (
	            ]]><include refid="data_skt_inv_list" /><![CDATA[
	            ) fq
		]]>
	</select>

	<select id="data_skt_inv_list_tot_cnt" parameterType="map"
		resultType="int">
	<![CDATA[
		SELECT
            COUNT(1) CNT
        FROM
            (
            ]]><include refid="data_skt_inv_list" /><![CDATA[
            )
	]]>
	</select>
</mapper>