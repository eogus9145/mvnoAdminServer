<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="telecentro.customer.customer_skt_view_cdr_pp_list_popup_frame">
	<sql id="customer_skt_view_cdr_pp_list_popup_frame">
	<![CDATA[
		SELECT /*+ INDEX_DESC(A SKT_CDR_PP_${@telecentro.common.service.CommonUtil@get_dollar_replace_query(selectYear)}_IDX1) */
			SERVICE_ACCOUNT,
			TO_CHAR(START_DATE, 'YYYY-MM-DD HH24:MI:SS') START_DATE,
			TO_CHAR(END_DATE, 'YYYY-MM-DD HH24:MI:SS') END_DATE,
			GUBUN,
			F_GET_COMMON_CD_NM('SKT_CDR_PP', 'GUBUN', GUBUN) GUBUN_NM,
			CALLED_NUM,
			TOT_DURATION,
			TOTAL_CHARGE,
			BEFORE_REMAINS,
			AFTER_REMAINS,
			CALLED_COUNTRY_CODE,
			VOICE_SCREEN_TYPE,
			'SKT' TELCO
		 FROM SKT_CDR_PP_${@telecentro.common.service.CommonUtil@get_dollar_replace_query(selectYear)} A
		 WHERE SERVICE_ACCOUNT = #{account}
	]]>
			${@telecentro.common.service.CommonUtil@get_section_query("END_DATE", null, s_dt, e_dt, "Y", null)}			
	</sql>
	
	<sql id="customer_skt_view_cdr_pp_list_popup_frame_add">
	<![CDATA[
	]]>
	</sql>
	
	<select id="customer_skt_view_cdr_pp_list_popup_frame" parameterType="map" resultType="egovMap">
	<![CDATA[
		SELECT
			fq.SERVICE_ACCOUNT,
			fq.START_DATE,
			fq.END_DATE,
			fq.GUBUN,
			fq.GUBUN_NM,
			fq.CALLED_NUM,
			fq.TOT_DURATION,
			fq.TOTAL_CHARGE,
			fq.BEFORE_REMAINS,
			fq.AFTER_REMAINS,
			fq.CALLED_COUNTRY_CODE,
			fq.VOICE_SCREEN_TYPE,
			fq.TELCO
	]]>
			<include refid="customer_skt_view_cdr_pp_list_popup_frame_add" />
	<![CDATA[
        FROM (
	]]>
			<include refid="customer_skt_view_cdr_pp_list_popup_frame" />
			ORDER BY A.SERVICE_ACCOUNT DESC, A.END_DATE DESC
			LIMIT #{endRowNum} OFFSET #{startRowNum}
	<![CDATA[
		) fq
	]]>
	</select>

	<select id="customer_skt_view_cdr_pp_list_popup_frame_excel" parameterType="map"
		resultType="egovMap">
		<![CDATA[
			SELECT
	            fq.*
	            ]]><include refid="customer_skt_view_cdr_pp_list_popup_frame_add" /><![CDATA[
	        FROM
	            (
	            ]]><include refid="customer_skt_view_cdr_pp_list_popup_frame" /><![CDATA[
	            ) fq
		]]>
	</select>

	<select id="customer_skt_view_cdr_pp_list_popup_frame_tot_cnt" parameterType="map"
		resultType="int">
	<![CDATA[
		SELECT
            COUNT(1) CNT
        FROM
            (
            ]]><include refid="customer_skt_view_cdr_pp_list_popup_frame" /><![CDATA[
            )
	]]>
	</select>
	
</mapper>