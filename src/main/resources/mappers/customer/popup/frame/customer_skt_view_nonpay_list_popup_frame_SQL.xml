<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="telecentro.customer.customer_skt_view_nonpay_list_popup_frame">
	<sql id="customer_skt_view_nonpay_list_popup_frame">
	<![CDATA[
		SELECT /*+ INDEX_DESC(A SKT_EVENT_FEE_IDX4) */
			EVENT_GUBUN,
			SERVICE_ACCOUNT,
			SERVICE_NUMBER,
			CUST_FRST_NM,
			TO_CHAR(BILL_DT, 'YYYY-MM') BILL_DT,
			BILL_PRICE,
			NON_PAY_PRICE,
			BILL_ZIP,
			BILL_ADDR,
			CUST_PHONE,
			SERVICE_STATUS,
			TO_CHAR(STOP_DT, 'YYYY-MM-DD') STOP_DT,
			TO_CHAR(CANCEL_DT, 'YYYY-MM-DD') CANCEL_DT,
			INPUT_ACCOUNT_BANK1,
			INPUT_ACCOUNT_NUM1,
			TO_CHAR(RECORD_DATE, 'YYYY-MM-DD') RECORD_DATE,
			INPUT_ACCOUNT_GUBUN
		FROM SKT_EVENT_FEE A
		WHERE SERVICE_ACCOUNT = #{account}
				AND RECORD_DATE >= TO_DATE(#{s_dt} || '-01', 'YYYY-MM-DD')
		 		AND RECORD_DATE < TO_DATE(#{e_dt} || '-01', 'YYYY-MM-DD') + INTERVAL '1 month'
		  		AND RECORD_DATE >= (SELECT TO_DATE(F_GET_CUSTOMER_INFO('OPEN_DATE','SKT',#{account}), 'YYYY-MM-DD HH24:MI:SS')) 
	]]>
			
	</sql>
	
	<sql id="customer_skt_view_nonpay_list_popup_frame_add">
	<![CDATA[
	]]>
	</sql>
	
	<select id="customer_skt_view_nonpay_list_popup_frame" parameterType="map" resultType="egovMap">
	<![CDATA[
		SELECT
			fq.EVENT_GUBUN,
			fq.SERVICE_ACCOUNT,
			fq.SERVICE_NUMBER,
			fq.CUST_FRST_NM,
			fq.BILL_DT,
			fq.BILL_PRICE,
			fq.NON_PAY_PRICE,
			fq.BILL_ZIP,
			fq.BILL_ADDR,
			fq.CUST_PHONE,
			fq.SERVICE_STATUS,
			fq.STOP_DT,
			fq.CANCEL_DT,
			fq.INPUT_ACCOUNT_BANK1,
			fq.INPUT_ACCOUNT_NUM1,
			fq.RECORD_DATE,
			fq.INPUT_ACCOUNT_GUBUN
	]]>
			<include refid="customer_skt_view_nonpay_list_popup_frame_add" />
	<![CDATA[
        FROM (
	]]>
			<include refid="customer_skt_view_nonpay_list_popup_frame" />
			ORDER BY A.SERVICE_ACCOUNT DESC, A.RECORD_DATE DESC
			LIMIT #{endRowNum} OFFSET #{startRowNum}
	<![CDATA[
		) fq
	]]>
	</select>

	<select id="customer_skt_view_nonpay_list_popup_frame_excel" parameterType="map"
		resultType="egovMap">
		<![CDATA[
			SELECT
	            fq.*
	            ]]><include refid="customer_skt_view_nonpay_list_popup_frame_add" /><![CDATA[
	        FROM
	            (
	            ]]><include refid="customer_skt_view_nonpay_list_popup_frame" /><![CDATA[
	            ) fq
		]]>
	</select>

	<select id="customer_skt_view_nonpay_list_popup_frame_tot_cnt" parameterType="map"
		resultType="int">
	<![CDATA[
		SELECT
            COUNT(1) CNT
        FROM
            (
            ]]><include refid="customer_skt_view_nonpay_list_popup_frame" /><![CDATA[
            )
	]]>
	</select>
	
</mapper>